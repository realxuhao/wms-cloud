<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bosch.storagein.mapper.MaterialRecevieMapper">

    <resultMap type="MaterialReceiveVO" id="MaterialReceiveVOResult">
        <result property="id" column="id"/>
        <result property="ssccNumber" column="sscc_number"/>
        <result property="batchNb" column="batch_nb"/>
        <result property="materialNb" column="material_nb"/>
        <result property="materialName" column="material_name"/>
        <result property="expireDate" column="expire_date"/>
        <result property="unit" column="unit"/>
        <result property="quantity" column="quantity"/>
        <result property="fromPurchaseOrder" column="from_purchase_order"/>
        <result property="poNumberItem" column="po_number_item"/>
        <result property="uploadUser" column="upload_user"/>
        <result property="uploadTime" column="upload_time"/>
        <result property="updateUser" column="update_user"/>
        <result property="updateTime" column="update_time"/>
        <result property="deleteFlag" column="delete_flag"/>
        <result property="status" column="status"/>
        <result property="editFlag" column="edit_flag"/>
    </resultMap>
    <sql id="selectMaterialReceiveVo">
        select sm.id,
               sm.sscc_number,
               sm.batch_nb,
               str_to_date(sm.expire_date, '%d/%m/%y') as expire_date,
               sm.material_nb,
               sm.unit,
               sm.quantity,
               sm.from_purchase_order,
               sm.po_number_item,
               sm.upload_user,
               sm.upload_time,
               sm.update_user,
               sm.update_time,
               sm.delete_flag,
               sm.status,
               sm.edit_flag
        from si_material_receive sm
    </sql>

    <select id="selectMaterialReceiveVOList" parameterType="MaterialReceiveDTO" resultMap="MaterialReceiveVOResult">
        select sm.id,
        sm.sscc_number,
        sm.batch_nb,
        str_to_date(sm.expire_date, '%d/%m/%y') as expire_date,
        sm.material_nb,
        mm.name as material_name,
        sm.unit,
        sm.quantity,
        sm.from_purchase_order,
        sm.po_number_item,
        sm.upload_user,
        sm.upload_time,
        sm.update_user,
        sm.update_time,
        sm.delete_flag,
        sm.status,
        sm.edit_flag
        from si_material_receive sm left join md_material mm on sm.material_nb = mm.code
        where sm.delete_flag=1
        <if test="ssccNumber != null  and ssccNumber != ''">and sm.sscc_number = #{ssccNumber}</if>
        <if test="materialNb != null  and materialNb != ''">and sm.material_nb = #{materialNb}</if>
        <if test="batchNb != null  and batchNb != ''">and sm.batch_nb = #{batchNb}</if>
        <if test="fromPurchaseOrder != null and fromPurchaseOrder != ''">and sm.from_purchase_order =
            #{fromPurchaseOrder}
        </if>
        <if test="status != null  and status != ''">and sm.status = #{status}</if>
    </select>

    <select id="selectMaterialReceiveVOBySncc" parameterType="string" resultMap="MaterialReceiveVOResult">
        <include refid="selectMaterialReceiveVo"/>
        where delete_flag=1 and sscc_number = #{snccNumber}
    </select>


    <select id="selectMaterialReceiveVOById" resultMap="MaterialReceiveVOResult">
        <include refid="selectMaterialReceiveVo"/>
        where delete_flag=1 and id = #{id}
    </select>


    <update id="deleteMaterialReceiveVOById" parameterType="Long">
        update si_material_receive
        set delete_flag = 0
        where id = #{id}
    </update>


    <update id="deleteMaterialReceiveVOByIds" parameterType="List">
        update si_material_receive set delete_flag = 0
        where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

    <update id="updateStatusBySscc">
        update si_material_receive
        set status = #{status}
        where sscc_number = #{ssccNumber}
    </update>

    <update id="updateEditFlag">
        update si_material_receive
        set edit_flag = #{editFlag}
        where id in
        <foreach item="id" collection="ids" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>




</mapper>